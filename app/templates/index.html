<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>首页</title>
<link href="/static/css/bootstrap.min.css" rel="stylesheet" />
<script src="/static/js/jquery-3.2.1.min.js" type="text/javascript"></script>
<script src="/static/js/bootstrap.min.js" type="text/javascript"></script>
<style type="text/css">
	body{
		padding-top:70px;
		background-color:#f3f3f3;
	}
	.navbar-brand {
		color: #fff;
		width: 200px;
		text-align: left;
		height: 60px;
		font-size: 24px;
		font-weight: 700;
		text-transform: uppercase;
		line-height: 30px;
	}
	.navbar-brand:hover{
		color:#1CC09F !important;
	}
	.nav-vertical-align{
		height:60px;
		line-height:30px !important;  /* 总高度为60px，其他样式中设定了上下padding为15px，所以此处设定行距为30px才能使字符垂直居中*/
	}
	.content{
		margin:2% 8%;
	}
	.right-float{
		float:right;
	}
	.table-set{
		height:263px;
		overflow:hidden;		
	}
	.td-set{
		width:33%;
		padding:8px;
		border-bottom:1px solid #CCCCCC;
	}
	.nav-font-size{
		font-size:18px;
	}
	
	h2{
		margin:3% 0;
	}
	.page-bt{
		float:right;
		margin:0;
	}
	.green {
		background-color: #1CC09F;
		color: #fff;
	}
	
</style>
</head>

<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="">Brand</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse " id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
		  <li class=""><a href="{{url_for('main.index')}}" class="nav-vertical-align nav-font-size">首页</a></li>
      </ul>
	  <div class="green right-float">
		  {% if current_user.is_authenticate %}
		  <ul class="nav navbar-nav navbar-right ">
			  <li class=""><a href="{{url_for('auth.login')}}" class="nav-vertical-align">登录</a></li>
		  </ul>
		  {%else%}
		  <ul class="nav navbar-nav navbar-right">
			  <li class=""><a href="{{url_for('auth.logout')}}" class="nav-vertical-align">退出登录</a></li>
		  </ul>
		  {%endif%}
	  </div>
    </div><!-- /.navbar-collapse -->	
  </div><!-- /.container-fluid -->
</nav>

<div>
	{% for message in get_flashed_messages() %}
	<div class="alert alert-warning">
		{{message}}
	</div>
	{% endfor %}
</div>
<div class="content">
	<h2>您好, {{current_user.username}}</h2>
	<div class="panel panel-default">
  		<div class="panel-heading">
    		<h2 class="panel-title">基站</h2>
  		</div>
  		<div class="panel-body">
    		<br />欢迎访问web_manager，请从下面列表中选择您将访问的基站。<br /><br />
			<button type="button" onclick="(function(){
						 url_t = window.location + 'addbase';
						 window.open(url_t,'_self');
						 })();">添加基站
			</button>
  		</div>
			
		  <table class="table ">
			<tr id='row'>
				<td class="td-set" id="id">基站ID</td>
				<td class="td-set" id="name">基站Name</td>
				<td class="td-set" id="num">通道数</td>
			</tr>
		  </table>
	</div>
	<nav aria-label="Page navigation">
		<ul class="pagination page-bt" id="paging">
		</ul>	
	</nav>
</div>
</body>

<script type="text/template" id="html_template">
<div class="right-float">
		<button type="button" class="btn btn-default" onclick="">
				<span class="glyphicon glyphicon glyphicon-zoom-in"></span>
		</button>
</div>
</script>
<script type="text/template" id="html_template1">
	<li><a type="button">1</a></li>
</script>

<script type="text/javascript">
//加载页面按钮
var page_num = {{pagenum}};
var paging = $("#paging");
var li_template = $("#html_template1").html();
for(var i=0;i<page_num;i++){
	paging.html(function(index,value){
		return value + li_template;
	});
}

//设置页面按钮显示的页数
$("#paging a").html(function(index){
	return index + 1;
});
//循环绑定页面按钮事件
for(var i=0;i<page_num;i++){
	$("#paging a").eq(i).bind("click",i,function(e){
		loadBS(e.data+1);
	});
}

//加载第一页的基站
loadBS(1);

//异步加载基站列表
function loadBS(num){
	var url = "http://" + location.host + "/index_data" + "?page=" + num;
	$.get(url,function(response,status,xhr){
		if(status == "success"){
			var tr_num = response.length;
			if(tr_num){
				var btn_template = $("#html_template").html();
				var bs_table = $("table").eq(0); 
				bs_table.find("tr:first").nextAll().remove();
						for(var i=0;i<tr_num;i++){
							var row = $("#row").clone();
							row.find("#id").text(response[i].BS_ID);
							row.find("#name").text(response[i].BS_Name);
							row.find("#num").html(response[i].num + btn_template);
							row.find("button").bind("click",i,function(e){
										url = window.location.href+"bs/"+response[e.data].BS_ID;
										window.location = url;			
							});
							bs_table.append(row[0]);
						}
			}
		}else{
			alert("页面加载失败");
		}
	},"json");
}
</script>
</html>
